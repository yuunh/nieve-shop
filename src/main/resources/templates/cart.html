<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>aranaz</title>
  <link rel="icon" href="img/favicon.png">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- animate CSS -->
  <link rel="stylesheet" href="css/animate.css">
  <!-- owl carousel CSS -->
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <!-- nice select CSS -->
  <link rel="stylesheet" href="css/nice-select.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="css/all.css">
  <!-- flaticon CSS -->
  <link rel="stylesheet" href="css/flaticon.css">
  <link rel="stylesheet" href="css/themify-icons.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="css/magnific-popup.css">
  <!-- swiper CSS -->
  <link rel="stylesheet" href="css/slick.css">
  <link rel="stylesheet" href="css/price_rangs.css">
  <!-- style CSS -->
  <link rel="stylesheet" href="css/style.css">

  <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
</head>

<body>
    <!--::header part start::-->
    <div th:replace="fragments/header :: 'header'"></div>
    <!-- Header part end-->


  <!--================Home Banner Area =================-->
  <!-- breadcrumb start-->
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2>Cart Products</h2>
              <p>Home <span>-</span>Cart Products</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start-->

  <!--================Cart Area =================-->
  <section class="cart_area padding_top">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">상품</th>
                <th scope="col">가격</th>
                <th scope="col">수량</th>
                <th scope="col">합계</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <th:block th:each="cart : ${cartList}">
                <tr th:id="'cart-item-[[' + ${cart.cartNo} + ']]'">
                  <td>
                    <div class="media">
                      <div class="d-flex">
                        <img th:src="${'/files/' + cart.product.fileName1}" style="max-width: 300px; max-height: 200px;">
                      </div>
                      <div class="media-body">
                        <p th:text="${cart.product.productName}" name="productName"></p>
                      </div>
                    </div>
                  </td>
                  <td>
                    <h5 th:text="'$' + ${cart.product.productPrice}" name="productPrice"></h5>
                  </td>
                  <td>
                    <div class="product_count">
                      <span class="input-number-decrement"> <i class="ti-angle-down"></i></span>
                      <input class="input-number" type="number" name="cartStock" th:value="${cart.cartStock}" />
                      <span class="input-number-increment"> <i class="ti-angle-up"></i></span>
                    </div>
                  </td>
                  <td>
                    <h5 th:text="'$' + ${cart.product.productPrice * cart.cartStock}"></h5>
                  </td>
                  <td>
                    <button type="button" class="btn btn-outline-secondary" th:onclick="'deleteItem(' + ${cart.cartNo} + ')'">삭제</button>
                  </td>
                </tr>
              </th:block>
              <tr>
                <td></td>
                <td></td>
                <td>
                  <h5>Subtotal</h5>
                </td>
                <td>
                  <h5 id="subtotal">2160.00</h5>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="checkout_btn_inner float-right">
            <a class="btn_1 checkout_btn_1" href="/checkout.html">결제하기</a>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!--================End Cart Area =================-->


  <!--::footer_part start::-->
  <div th:replace="fragments/footer :: 'footer'"></div>
  <!--::footer_part end::-->

  <!-- jquery plugins here-->
  <!-- jquery -->
  <script src="js/jquery-1.12.1.min.js"></script>
  <!-- popper js -->
  <script src="js/popper.min.js"></script>
  <!-- bootstrap js -->
  <script src="js/bootstrap.min.js"></script>
  <!-- easing js -->
  <script src="js/jquery.magnific-popup.js"></script>
  <!-- swiper js -->
  <script src="js/swiper.min.js"></script>
  <!-- swiper js -->
  <script src="js/masonry.pkgd.js"></script>
  <!-- particles js -->
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.nice-select.min.js"></script>
  <!-- slick js -->
  <script src="js/slick.min.js"></script>
  <script src="js/jquery.counterup.min.js"></script>
  <script src="js/waypoints.min.js"></script>
  <script src="js/contact.js"></script>
  <script src="js/jquery.ajaxchimp.min.js"></script>
  <script src="js/jquery.form.js"></script>
  <script src="js/jquery.validate.min.js"></script>
  <script src="js/mail-script.js"></script>
  <script src="js/stellar.js"></script>
  <script src="js/price_rangs.js"></script>
  <!-- custom js -->
  <script src="js/custom.js"></script>

    <script type="text/javascript">
      $(document).ready(function(){
    	$("input[name='cartStock']").on("change", function(evt){
    	  alert("changed" + evt.target);
    	});
      });

      function onStockChange(){

      }

      // 카카오 결제
      function confirmBuy(){

        const names = $("p[name=productName]")
        const count = names.size();
        const firstName = names.first().text();

        console.log("count : " + count);
        console.log("first name : " + firstName);

        const orderName = (count > 1) ? firstName + " 외 " + (count - 1) : firstName;

        const priceSum = parseInt($("#subtotal").text());

        PortOne.requestPayment({
          // Store ID 설정

          storeId: "store-75557aa8-5f21-452a-9e2c-0ea435b48e2a",
          // 채널 키 설정
          channelKey: "channel-key-fa24fffc-de3e-40e0-ae09-ddc7835e7721",
          paymentId: `payment-${crypto.randomUUID()}`,
          orderName: orderName,
          totalAmount: priceSum,
          currency: "CURRENCY_KRW",
          payMethod: "EASY_PAY",
        }).then(r  => console.log(r));
      }

      // 장바구니 상품 삭제
<!--      const deleteById  = (cartNo) => {-->
<!--        const reqUrl = "/cart/"+cartNo-->
<!--        $.ajax({-->
<!--            type : 'delete',-->
<!--            url : reqUrl,-->

<!--            success : function(){-->
<!--               alert('삭제되었습니다.');-->
<!--               location.reload();-->
<!--            }, error(){-->
<!--                alert('ajax 실패')-->
<!--            }-->
<!--        })-->
<!--      }-->
      function deleteItem(cartNo) {
          fetch(`/cart/delete-item/${cartNo}`, {
              method: 'DELETE',
              headers: {
                  'Content-Type': 'application/json'
              }
          })
          .then(response => {
              if (response.ok) {
                  document.getElementById(`cart-item-${cartNo}`).remove();
                  alert("항목이 성공적으로 삭제되었습니다!");
              } else {
                  alert("항목 삭제에 실패했습니다.");
              }
          })
          .catch(error => {
              console.error('오류:', error);
              alert("항목을 삭제하는 동안 오류가 발생했습니다.");
          });
      }

    </script>

</body>
</html>